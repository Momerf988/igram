{"ast":null,"code":"import React,{useState,useEffect,useContext}from'react';import{useNavigate}from'react-router-dom';import{AuthContext}from'../context/AuthContext';import axios from'axios';import API_URL from'../config/api';import PostCard from'../components/PostCard';import'./ConsumerView.css';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const ConsumerView=()=>{const navigate=useNavigate();const{user}=useContext(AuthContext);const[posts,setPosts]=useState([]);const[filteredPosts,setFilteredPosts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[searchQuery,setSearchQuery]=useState('');const[consumerName,setConsumerName]=useState('');useEffect(()=>{fetchPosts();// Check if name is stored in localStorage\nconst storedName=localStorage.getItem('consumerName');if(storedName&&storedName.trim()){setConsumerName(storedName);}},[]);useEffect(()=>{if(searchQuery.trim()){const query=searchQuery.toLowerCase();const filtered=posts.filter(post=>{var _post$title,_post$caption,_post$location;const titleMatch=(_post$title=post.title)===null||_post$title===void 0?void 0:_post$title.toLowerCase().includes(query);const captionMatch=(_post$caption=post.caption)===null||_post$caption===void 0?void 0:_post$caption.toLowerCase().includes(query);const locationMatch=(_post$location=post.location)===null||_post$location===void 0?void 0:_post$location.toLowerCase().includes(query);return titleMatch||captionMatch||locationMatch;});setFilteredPosts(filtered);}else{setFilteredPosts(posts);}},[searchQuery,posts]);const fetchPosts=async()=>{try{const response=await axios.get(\"\".concat(API_URL,\"/posts/public\"));setPosts(response.data);setFilteredPosts(response.data);}catch(err){setError('Failed to load posts');}finally{setLoading(false);}};const handleLikeToggle=async postId=>{if(!consumerName.trim()){return;}try{await axios.post(\"\".concat(API_URL,\"/likes/public/\").concat(postId),{consumerName:consumerName.trim()});fetchPosts();}catch(err){console.error('Failed to toggle like:',err);}};const handleCommentAdded=()=>{fetchPosts();};const handleComment=async(postId,commentText)=>{if(!consumerName.trim()){return;}try{await axios.post(\"\".concat(API_URL,\"/comments/public\"),{postId,text:commentText,consumerName:consumerName.trim()});fetchPosts();}catch(err){console.error('Failed to add comment:',err);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading posts...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"consumer-view\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"consumer-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"igram\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"header-actions\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"search-container\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"search-input\",placeholder:\"Search by title, caption, or location...\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value)})}),!consumerName&&/*#__PURE__*/_jsx(\"button\",{className:\"interact-btn\",onClick:()=>navigate('/consumer-signup'),children:\"Login to Interact\"}),consumerName&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"user-info\",children:consumerName}),/*#__PURE__*/_jsx(\"button\",{className:\"logout-btn\",onClick:()=>{localStorage.removeItem('consumerName');setConsumerName('');window.location.href='/';},children:\"Logout\"})]}),user&&user.role==='creator'?/*#__PURE__*/_jsx(\"button\",{className:\"logout-btn\",onClick:()=>navigate('/home'),children:\"Creator View\"}):/*#__PURE__*/_jsx(\"button\",{className:\"creator-login-btn\",onClick:()=>navigate('/creator-login'),children:\"Login for Creator\"})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsx(\"div\",{className:\"posts-container\",children:filteredPosts.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"no-posts\",children:searchQuery?'No posts found matching your search.':'No posts yet.'}):filteredPosts.map(post=>/*#__PURE__*/_jsx(PostCard,{post:post,currentUser:{id:consumerName,name:consumerName,role:'consumer'},onLikeToggle:handleLikeToggle,onCommentAdded:handleCommentAdded,onComment:handleComment,isConsumerView:true,consumerName:consumerName},post._id))})]});};export default ConsumerView;","map":{"version":3,"names":["React","useState","useEffect","useContext","useNavigate","AuthContext","axios","API_URL","PostCard","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ConsumerView","navigate","user","posts","setPosts","filteredPosts","setFilteredPosts","loading","setLoading","error","setError","searchQuery","setSearchQuery","consumerName","setConsumerName","fetchPosts","storedName","localStorage","getItem","trim","query","toLowerCase","filtered","filter","post","_post$title","_post$caption","_post$location","titleMatch","title","includes","captionMatch","caption","locationMatch","location","response","get","concat","data","err","handleLikeToggle","postId","console","handleCommentAdded","handleComment","commentText","text","className","children","type","placeholder","value","onChange","e","target","onClick","removeItem","window","href","role","length","map","currentUser","id","name","onLikeToggle","onCommentAdded","onComment","isConsumerView","_id"],"sources":["C:/Users/Omer/mini-instagram-app/frontend/src/pages/ConsumerView.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { AuthContext } from '../context/AuthContext';\r\nimport axios from 'axios';\r\nimport API_URL from '../config/api';\r\nimport PostCard from '../components/PostCard';\r\nimport './ConsumerView.css';\r\n\r\nconst ConsumerView = () => {\r\n  const navigate = useNavigate();\r\n  const { user } = useContext(AuthContext);\r\n  const [posts, setPosts] = useState([]);\r\n  const [filteredPosts, setFilteredPosts] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [consumerName, setConsumerName] = useState('');\r\n\r\n  useEffect(() => {\r\n    fetchPosts();\r\n    // Check if name is stored in localStorage\r\n    const storedName = localStorage.getItem('consumerName');\r\n    if (storedName && storedName.trim()) {\r\n      setConsumerName(storedName);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (searchQuery.trim()) {\r\n      const query = searchQuery.toLowerCase();\r\n      const filtered = posts.filter(post => {\r\n        const titleMatch = post.title?.toLowerCase().includes(query);\r\n        const captionMatch = post.caption?.toLowerCase().includes(query);\r\n        const locationMatch = post.location?.toLowerCase().includes(query);\r\n        return titleMatch || captionMatch || locationMatch;\r\n      });\r\n      setFilteredPosts(filtered);\r\n    } else {\r\n      setFilteredPosts(posts);\r\n    }\r\n  }, [searchQuery, posts]);\r\n\r\n  const fetchPosts = async () => {\r\n    try {\r\n      const response = await axios.get(`${API_URL}/posts/public`);\r\n      setPosts(response.data);\r\n      setFilteredPosts(response.data);\r\n    } catch (err) {\r\n      setError('Failed to load posts');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleLikeToggle = async (postId) => {\r\n    if (!consumerName.trim()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await axios.post(`${API_URL}/likes/public/${postId}`, {\r\n        consumerName: consumerName.trim()\r\n      });\r\n      fetchPosts();\r\n    } catch (err) {\r\n      console.error('Failed to toggle like:', err);\r\n    }\r\n  };\r\n\r\n  const handleCommentAdded = () => {\r\n    fetchPosts();\r\n  };\r\n\r\n  const handleComment = async (postId, commentText) => {\r\n    if (!consumerName.trim()) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await axios.post(`${API_URL}/comments/public`, {\r\n        postId,\r\n        text: commentText,\r\n        consumerName: consumerName.trim()\r\n      });\r\n      fetchPosts();\r\n    } catch (err) {\r\n      console.error('Failed to add comment:', err);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"loading\">Loading posts...</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"consumer-view\">\r\n      <header className=\"consumer-header\">\r\n        <h1>igram</h1>\r\n        <div className=\"header-actions\">\r\n          <div className=\"search-container\">\r\n            <input\r\n              type=\"text\"\r\n              className=\"search-input\"\r\n              placeholder=\"Search by title, caption, or location...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n            />\r\n          </div>\r\n          {!consumerName && (\r\n            <button className=\"interact-btn\" onClick={() => navigate('/consumer-signup')}>\r\n              Login to Interact\r\n            </button>\r\n          )}\r\n          {consumerName && (\r\n            <>\r\n              <span className=\"user-info\">\r\n                {consumerName}\r\n              </span>\r\n              <button className=\"logout-btn\" onClick={() => {\r\n                localStorage.removeItem('consumerName');\r\n                setConsumerName('');\r\n                window.location.href = '/';\r\n              }}>\r\n                Logout\r\n              </button>\r\n            </>\r\n          )}\r\n          {user && user.role === 'creator' ? (\r\n            <button className=\"logout-btn\" onClick={() => navigate('/home')}>\r\n              Creator View\r\n            </button>\r\n          ) : (\r\n            <button className=\"creator-login-btn\" onClick={() => navigate('/creator-login')}>\r\n              Login for Creator\r\n            </button>\r\n          )}\r\n        </div>\r\n      </header>\r\n\r\n\r\n      {error && <div className=\"error-message\">{error}</div>}\r\n\r\n      <div className=\"posts-container\">\r\n        {filteredPosts.length === 0 ? (\r\n          <div className=\"no-posts\">\r\n            {searchQuery ? 'No posts found matching your search.' : 'No posts yet.'}\r\n          </div>\r\n        ) : (\r\n          filteredPosts.map(post => (\r\n            <PostCard\r\n              key={post._id}\r\n              post={post}\r\n              currentUser={{ id: consumerName, name: consumerName, role: 'consumer' }}\r\n              onLikeToggle={handleLikeToggle}\r\n              onCommentAdded={handleCommentAdded}\r\n              onComment={handleComment}\r\n              isConsumerView={true}\r\n              consumerName={consumerName}\r\n            />\r\n          ))\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConsumerView;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}